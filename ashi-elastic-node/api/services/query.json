{
    "left_side_filter_query": {
        "query": {
            "bool": {
                "filter": [
                    {
                        "nested": {
                            "path": "retailer_data",
                            "query": {
                                "bool": {
                                    "must": [
                                        {
                                            "term": {
                                                "retailer_data.retailer_id": ""
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    },
                    {
                        "nested": {
                            "path": "category",
                            "query": {
                                "bool": {
                                    "must": [
                                        
                                    ]
                                }
                            }
                        }
                    },
                    {
                        "nested": {
                            "path": "SpecificationAttribute_Mapping",
                            "query": {
                                "bool": {
                                    "must": []
                                }
                            }
                        }
                    }
                ]
            }
        },
        "size": 0,
        "aggs": {
            "category_count": {
                "nested": {
                    "path": "category"
                },
                "aggs": {
                    "filtered_docs": {
                        "filter": {
                            "bool": {
                                "should": [
                                    
                                ]
                            }
                        },
                        "aggs":  {
                            "category_info": {
                                  "composite": {
                                      "size": 100,
                                      "sources": [
                                          {
                                              "category_name": {
                                                  "terms": {
                                                      "field": "category.CATEGORY_NAME"
                                                  }
                                              }
                                          },
                                          {
                                              "category_id": {
                                                  "terms": {
                                                      "field": "category.CATEGORY_ID"
                                                  }
                                              }
                                          },
                                     {
                                        "seq_num": {
                                            "terms": {
                                                "field": "category.SEQ_NUM"
                                            }
                                        }
                                    }
                                      ]
                                  }
                              }
                          }
                    }
                }
            },
            "attribute_aggs": {
                "nested": {
                    "path": "SpecificationAttribute_Mapping"
                },
                "aggs": {
                    "filtered_docs": {
                        "filter": {
                            "bool": {
                                "should": []
                            }
                        },
                        "aggs": {
                            "metal_karat_count": {
                                "composite": {
                                    "size": 100,
                                    "sources": [
                                        {
                                            "metal_karat_count": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.Metal_Karat"
                                                }
                                            }
                                        },
                                         {
                                            "seq_num": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                }
                                            }
                                        }
                                    ]
                                }
                            },
                            "metal_color_count": {
                                "composite": {
                                    "size": 100,
                                    "sources": [
                                        {
                                            "metal_color_count": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.Metal_Color"
                                                }
                                            }
                                        },
                                         {
                                            "seq_num": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                }
                                            }
                                        }
                                    ]
                                }
                            },
                            "diamond_quality_count": {
                                "composite": {
                                    "size": 100,
                                    "sources": [
                                        {
                                            "diamond_quality_count": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.Diamond_Quality"
                                                }
                                            }
                                        },
                                         {
                                            "seq_num": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                }
                                            }
                                        }
                                    ]
                                }
                            },
                            "product_style_count": {
                                "composite": {
                                    "size": 100,
                                    "sources": [
                                        {
                                            "product_style_count": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.Product_Style"
                                                }
                                            }
                                        },
                                         {
                                            "seq_num": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                }
                                            }
                                        }
                                    ]
                                }
                            },
                            "total_kt_weighttotal_karat_weight_count": {
                                "composite": {
                                    "size": 100,
                                    "sources": [
                                        {
                                            "total_karat_weight_count": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.Total_Karat_Weight"
                                                }
                                            }
                                        },
                                         {
                                            "seq_num": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                }
                                            }
                                        }
                                    ]
                                }
                            },
                            "total_diamondWt_count": {
                                "composite": {
                                    "size": 100,
                                    "sources": [
                                        {
                                            "total_diamondWt_count": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.Total_Diamond_Wt_Appx"
                                                }
                                            }
                                        },
                                         {
                                            "seq_num": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                }
                                            }
                                        }
                                    ]
                                }
                            },
                            "stone_clarity_count": {
                                "composite": {
                                    "size": 100,
                                    "sources": [
                                        {
                                            "stone_clarity_count": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.Stone_Clarity"
                                                }
                                            }
                                        },
                                         {
                                            "seq_num": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                }
                                            }
                                        }
                                    ]
                                }
                            },
                            "center_stone_carat_count": {
                                "composite": {
                                    "size": 100,
                                    "sources": [
                                        {
                                            "center_stone_carat_count": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.Center_Stone_Carat"
                                                }
                                            }
                                        },
                                         {
                                            "seq_num": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                }
                                            }
                                        }
                                    ]
                                }
                            },
                            "stone_shape_count": {
                                "composite": {
                                    "size": 100,
                                    "sources": [
                                        {
                                            "stone_shape_count": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.Stone_Shape"
                                                }
                                            }
                                        },
                                         {
                                            "seq_num": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                }
                                            }
                                        }
                                    ]
                                }
                            },
                            "stone_ct_mm_size_count": {
                                "composite": {
                                    "size": 100,
                                    "sources": [
                                        {
                                            "stone_ct_mm_size_count": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.Stone_Ct_MM_Size_Appx"
                                                }
                                            }
                                        },
                                         {
                                            "seq_num": {
                                                "terms": {
                                                    "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                }
                                            }
                                        }
                                    ]
                                }
                            }
                            
                        }
                    }
                }
            },
            "retailer_price": {
                "nested": {
                    "path": "retailer_data"
                },
                "aggs": {
                    "filtered_docs": {
                        "filter": {
                            "bool": {
                                "must": [
                                    {
                                        "term": {
                                            "retailer_data.retailer_id": "CARTJA"
                                        }
                                    }
                                ]
                            }
                        },
                        "aggs": {
                            "range_aggs": {
                                "range": {
                                    "field": "retailer_data.Price",
                                    "ranges": [
                                        {
                                            "to": 500
                                        },
                                        {
                                            "from": 501,
                                            "to": 1000
                                        },
                                        {
                                            "from": 1001,
                                            "to": 2000
                                        },
                                        {
                                            "from": 2001,
                                            "to": 3000
                                        },
                                        {
                                            "from": 3001,
                                            "to": 5000
                                        },
                                        {
                                            "from": 5001
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "item_query": {
        "query": {
            "bool": {
                "filter": [
                    {
                        "nested": {
                            "path": "retailer_data",
                            "query": {
                                "bool": {
                                    "must": [
                                        {
                                            "term": {
                                                "retailer_data.retailer_id": "CARTJA"
                                            }
                                        }
                                    ]
                                }
                            },
                            "inner_hits": {
                                "_source": [
                                    "retailer_data.Price"
                                ]
                            }
                        }
                    },
                    {
                        "nested": {
                            "path": "category",
                            "query": {
                                "bool": {
                                    "must": [
                                        
                                    ]
                                }
                            }
                        }
                    },
                    {
                        "nested": {
                            "path": "SpecificationAttribute_Mapping",
                            "query": {
                                "bool": {
                                    "must": []
                                }
                            }
                        }
                    },
                    {
                        "nested": {
                            "path": "retailer_data",
                            "query": {
                                "bool": {
                                    "should": [
                                        {
                                            "range": {
                                                "retailer_data.Price": {
                                                    "to": 500
                                                }
                                            }
                                        },
                                        {
                                            "range": {
                                                "retailer_data.Price": {
                                                    "from": 501,
                                                    "to": 1000
                                                }
                                            }
                                        },
                                        {
                                            "range": {
                                                "retailer_data.Price": {
                                                    "from": 1001,
                                                    "to": 2000
                                                }
                                            }
                                        },
                                        {
                                            "range": {
                                                "retailer_data.Price": {
                                                    "from": 2001,
                                                    "to": 3000
                                                }
                                            }
                                        },
                                        {
                                            "range": {
                                                "retailer_data.Price": {
                                                    "from": 3001,
                                                    "to": 5000
                                                }
                                            }
                                        },
                                        {
                                            "range": {
                                                "retailer_data.Price": {
                                                    "from": 5001
                                                }
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                ]
            }
        },
        "size": 0,
        "from": 0,
        "track_total_hits": true,
        "_source": [
            "product_data.ITEM_ID",
            "product_data.ITEM_NAME",
            "product_data.IMAGE_URL_1",
            "product_data.IMAGE_URL_2",
            "product_data.IMAGE_URL_3",
            "product_data.IMAGE_URL_4",
            "product_data.ITEM_CD",
            "product_data.SHORT_WEB_DESC"
        ]
    },

    "search_query_popup":
    {
        "query": {
            "bool": {
                "must": [
                    {
                        "multi_match": {
                            "query": "1/10 Ctw",
                            "fields": [
                                "product_data.ITEM_NAME^3",
                                "product_data.SHORT_WEB_DESC^2",
                                "product_data.ITEM_CD",
                                "product_data.Search_Keywords"
                            ],
                            "type": "phrase_prefix"
                        }
                    },
                    {
                        "nested": {
                            "path": "retailer_data",
                            "query": {
                                "bool": {
                                    "must": [
                                        {
                                            "match": {
                                                "retailer_data.retailer_id": "CARTJA"
                                            }
                                        }
                                    ]
                                }
                            },
                            "inner_hits": {
                                "_source": [
                                    "retailer_data.Price"
                                ]
                            }
                        }
                    }
                ],
                "should": [
                   
                    {
                        "nested": {
                            "path": "SpecificationAttribute_Mapping",
                            "query": {
                                "bool": {
                                    "must": [
                                        {
                                            "match": {
                                                "SpecificationAttribute_Mapping.Category_Type": "Diamond Rings"
                                            }
                                        },
                                         {
                                            "terms": {
                                                "SpecificationAttribute_Mapping.Product_Style": [
                                                    "Fancy"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            },
                            "boost": 3
                        }
                    }
                ]
            }
        },
        "size": 10,
        "from": 0,
        "_source": [
            "product_data.ITEM_ID",
            "product_data.ITEM_CD",
            "product_data.ITEM_NAME",
            "product_data.IMAGE_URL_1",
            "product_data.SHORT_WEB_DESC"
        ]
    },
    "best_seller":{
  
        "query": {
          "bool": {
                      "filter": [
                          {
                              "nested": {
                                  "path": "retailer_data",
                                  "query": {
                                      "bool": {
                                          "must": [
                                              {
                                                  "term": {
                                                      "retailer_data.retailer_id": "CARTJA"
                                                  }
                                              }
                                          ]
                                      }
                                  },
                                  "inner_hits": {
                                      "_source": [
                                          "retailer_data.Price"
                                      ]
                                  }
                              }
                          }
                      ]
                  }
        },
        "sort": [
          {
            "product_data.BestSeller_DisplayOrder": {
              "order": "asc"
            }
          }
        ],
        "size": 10,
        "_source": [
                  "product_data.ITEM_ID",
                  "product_data.ITEM_NAME",
                  "product_data.IMAGE_URL_1",
                  "product_data.ITEM_CD",
                  "product_data.SHORT_WEB_DESC",
                  "product_data.BestSeller_DisplayOrder"
              ]
      },
      
      "item_search_query": {
          "query": {
              "bool": {
                "must": [
                            {
                                "multi_match": {
                                "fields": ["product_data.ITEM_NAME","product_data.ITEM_CD", "product_data.SHORT_WEB_DESC", "product_data.search_keywords^3", "SpecificationAttribute_Mapping.CustomValue^2"],
                                "type": "phrase_prefix"
                            }
                        }
                    ],
                  "filter": [
                      {
                          "nested": {
                              "path": "retailer_data",
                              "query": {
                                  "bool": {
                                      "must": [
                                          {
                                              "term": {
                                                  "retailer_data.retailer_id": "CARTJA"
                                              }
                                          }
                                      ]
                                  }
                              },
                              "inner_hits": {
                                  "_source": [
                                      "retailer_data.Price"
                                  ]
                              }
                          }
                      }
                  ]
              }
          },
          "size": 0,
          "from": 0,
          "_source": [
              "product_data.ITEM_ID",
              "product_data.ITEM_NAME",
              "product_data.IMAGE_URL_1",
              "product_data.IMAGE_URL_2",
              "product_data.IMAGE_URL_3",
              "product_data.IMAGE_URL_4",
              "product_data.ITEM_CD",
              "product_data.SHORT_WEB_DESC"
          ]
      },

      "trending_products":        {
            "query": {
                "match_all": {}
            },
            "sort": [
                {
                    "count": {
                        "order": "desc"
                    }
                }
            ],
            "size": 5,
            "from": 0
    },
    "left_search_filter_query": 

        {
            "query": {
                "bool": {
                    "must": [
                        {
                            "multi_match": {
                                "query": "",
                                "fields": [
                                    "product_data.ITEM_NAME^3",
                                    "product_data.SHORT_WEB_DESC^2",
                                    "product_data.ITEM_CD",
                                    "product_data.Search_Keywords"
                                ],
                                "type": "phrase_prefix"
                            }
                        }
                    ],
                    "filter": [
                        {
                            "nested": {
                                "path": "retailer_data",
                                "query": {
                                    "bool": {
                                        "must": [
                                            {
                                                "match": {
                                                    "retailer_data.retailer_id": "CARTJA"
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    ]
                
                }
            },
            "aggs": {
                "attribute_aggs": {
                    "nested": {
                        "path": "SpecificationAttribute_Mapping"
                    },
                    "aggs": {
                        "filtered_docs": {
                            "filter": {
                                "bool": {
                                    "should": []
                                }
                            },
                            "aggs": {
                                "metal_karat_count": {
                                    "composite": {
                                        "size": 100,
                                        "sources": [
                                            {
                                                "metal_karat_count": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.Metal_Karat"
                                                    }
                                                }
                                            },
                                            {
                                                "seq_num": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                },
                                 "product_style_count": {
                                    "composite": {
                                        "size": 100,
                                        "sources": [
                                            {
                                                "product_style_count": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.Product_Style"
                                                    }
                                                }
                                            },
                                            {
                                                "seq_num": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                },
                                "metal_color_count": {
                                    "composite": {
                                        "size": 100,
                                        "sources": [
                                            {
                                                "metal_color_count": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.Metal_Color"
                                                    }
                                                }
                                            },
                                            {
                                                "seq_num": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                },
                                "diamond_quality_count": {
                                    "composite": {
                                        "size": 100,
                                        "sources": [
                                            {
                                                "diamond_quality_count": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.Diamond_Quality"
                                                    }
                                                }
                                            },
                                            {
                                                "seq_num": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                },
                                "total_karat_weight_count": {
                                    "composite": {
                                        "size": 100,
                                        "sources": [
                                            {
                                                "total_karat_weight_count": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.Total_Carat_Weight"
                                                    }
                                                }
                                            },
                                            {
                                                "seq_num": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                },
                                "total_diamondWt_count": {
                                    "composite": {
                                        "size": 100,
                                        "sources": [
                                            {
                                                "total_diamondWt_count": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.Total_Diamond_Wt_Appx"
                                                    }
                                                }
                                            },
                                            {
                                                "seq_num": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                },
                                "center_stone_carat_count": {
                                    "composite": {
                                        "size": 100,
                                        "sources": [
                                            {
                                                "center_stone_carat_count": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.Center_Stone_Carat"
                                                    }
                                                }
                                            },
                                            {
                                                "seq_num": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                },
                                "stone_shape_count": {
                                    "composite": {
                                        "size": 100,
                                        "sources": [
                                            {
                                                "stone_shape_count": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.Stone_Shape"
                                                    }
                                                }
                                            },
                                            {
                                                "seq_num": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                },
                                "stone_ct_mm_size_count": {
                                    "composite": {
                                        "size": 100,
                                        "sources": [
                                            {
                                                "stone_ct_mm_size_count": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.Stone_Ct_MM_Size_Appx"
                                                    }
                                                }
                                            },
                                            {
                                                "seq_num": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                },
        
                                "collection_count": {
                                    "composite": {
                                        
                                        "sources": [
                                            {
                                                "collection_count": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.Collection"
                                                    }
                                                }
                                            },
                                            {
                                                "seq_num": {
                                                    "terms": {
                                                        "field": "SpecificationAttribute_Mapping.DisplayOrder"
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                }
        
                            }
                        }
                    }
                }
            },
            "size": 0
        }
    }
